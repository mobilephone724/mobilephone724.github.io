<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Posts on </title>
    <link>/posts/</link>
    <description>Recent content in Posts on </description>
    <generator>Hugo</generator>
    <language>en</language>
    <lastBuildDate>Wed, 03 Sep 2025 21:01:17 +0800</lastBuildDate>
    <atom:link href="/posts/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>PG: How to restart bgworker</title>
      <link>/posts/20250903-2/</link>
      <pubDate>Wed, 03 Sep 2025 21:01:17 +0800</pubDate>
      <guid>/posts/20250903-2/</guid>
      <description>&lt;h2 id=&#34;postmaster-的代码路径&#34;&gt;postmaster 的代码路径&lt;/h2&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-txt&#34; data-lang=&#34;txt&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-&amp;gt;ServerLoop&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  -&amp;gt;WaitEventSetWait&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  -&amp;gt;process_pm_child_exit&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    -&amp;gt;waitpid(-1, )&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    -&amp;gt;CleanupBackgroundWorker()&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;CleanupBackgroundWorker&lt;/code&gt; 的细节：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;如果bgworker以 0 退出，则正常退出，不参与重启逻辑。&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;如果以 1 退出，进入后续的正常重启逻辑&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;否则，视为系统级 crash， 重启整个实例。&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;关键变量：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;RegisteredBgWorker.rw_crashed_at&lt;/code&gt; 非 0 视为崩溃&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;HaveCrashedWorker&lt;/code&gt;  postmaster 在本轮循环是是否检测到了 bgworker 崩溃&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;StartWorkerNeeded&lt;/code&gt; 此刻是否需要重启 bgworker 。bgworker 支持设置重启间隔，所以 postmaster 在每次循环中，不总会重启所有崩溃的的 bgworker&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2 id=&#34;appendix&#34;&gt;appendix&lt;/h2&gt;&#xA;&lt;h3 id=&#34;waitpid&#34;&gt;waitpid&lt;/h3&gt;&#xA;&lt;p&gt;(Generated from AI, haven&amp;rsquo;t been confirmed by myself)&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f00&#34;&gt;while&lt;/span&gt; ((pid = &lt;span style=&#34;color:#ff0&#34;&gt;waitpid&lt;/span&gt;(-&lt;span style=&#34;color:#f60&#34;&gt;1&lt;/span&gt;, &amp;amp;exitstatus, WNOHANG)) &amp;gt; &lt;span style=&#34;color:#f60&#34;&gt;0&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;If multiple child processes have already terminated before this loop runs:&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;The loop will collect them one by one, in the order determined by the operating system&amp;rsquo;s process table&lt;/li&gt;&#xA;&lt;li&gt;Each iteration of the loop will retrieve one zombie process&lt;/li&gt;&#xA;&lt;li&gt;The loop will continue until all terminated child processes have been collected&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;When a child process terminates in a Unix/Linux system, it doesn&amp;rsquo;t immediately disappear from the system. Instead, it enters a &amp;ldquo;zombie&amp;rdquo; state (sometimes called a &amp;ldquo;defunct&amp;rdquo; state). In this state:&lt;/p&gt;</description>
    </item>
    <item>
      <title>English Listening Practice (1-1)</title>
      <link>/posts/20250903-1/</link>
      <pubDate>Wed, 03 Sep 2025 20:27:55 +0800</pubDate>
      <guid>/posts/20250903-1/</guid>
      <description>&lt;p&gt;FROM &lt;a href=&#34;https://www.youtube.com/watch?v=y3yAVZk3tyA&amp;amp;t=251s&amp;amp;ab_channel=LexFridman&#34;&gt;https://www.youtube.com/watch?v=y3yAVZk3tyA&amp;amp;t=251s&amp;amp;ab_channel=LexFridman&lt;/a&gt;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;The following is a conversation with Keyu Jin, an &lt;strong&gt;economist&lt;/strong&gt; at the London School of Economics, specializing in China&amp;rsquo;s economy, international &lt;strong&gt;macroeconomics&lt;/strong&gt;, global trade imbalances, and financial policy. She wrote the &lt;strong&gt;highly lauded&lt;/strong&gt; book on China titled &amp;ldquo;The New China Playbook: Beyond Socialism and Capitalism,&amp;rdquo; that details China&amp;rsquo;s economic transformation since 1978 to today. And it &lt;strong&gt;dispels&lt;/strong&gt; a lot of misconceptions about China&amp;rsquo;s economy that people in the West have. This is the &amp;ldquo;Lex Fridman Podcast.&amp;rdquo; To support it, please check out our sponsors in the description and consider subscribing to this channel. And now, dear friends, here&amp;rsquo;s Keyu Jin. What is the single biggest &lt;strong&gt;misconception&lt;/strong&gt; the West has about China&amp;rsquo;s economy today?&lt;/li&gt;&#xA;&lt;li&gt;The biggest misunderstanding is somehow that a group of people, or even just one person, runs the entire Chinese economy. It is far from the reality. It is a very complex, large economy. And even if there is an extreme form of political centralization, the economy is totally decentralized. The role that the local mayors, I call this the mayor economy, plays in reforms, but also driving the technological innovation that we&amp;rsquo;re seeing right now, it is actually not run by just a handful of people. It&amp;rsquo;s more decentralized than the US&amp;rsquo;s. And I think more broadly, a big misunderstanding is really the relationship between Chinese people and authority.&lt;/li&gt;&#xA;&lt;li&gt;Can you &lt;strong&gt;elaborate on that&lt;/strong&gt;?&lt;/li&gt;&#xA;&lt;li&gt;Well, people think that somehow there&amp;rsquo;s almost blind submission to authority in China. We have a very &lt;strong&gt;nuanced&lt;/strong&gt; relationship with authority, whether it is between kids and parents, or students and their teachers, or with your bosses and the Chinese government, it&amp;rsquo;s kind of the same thing. There&amp;rsquo;s &lt;strong&gt;paternalism&lt;/strong&gt;, they think that they&amp;rsquo;re responsible for you, but deference, a certain amount of deference to authority is not blind submission. It&amp;rsquo;s been written in implicitly in our contract for thousands of years that in exchange for some &lt;strong&gt;deference&lt;/strong&gt;, we are given stability, security, and peace, and hopefully, prosperity.&lt;/li&gt;&#xA;&lt;li&gt;So there is some element that we have in the West of freedom of the individual, so that a little bit of the &lt;strong&gt;rebel&lt;/strong&gt; is allowed imbalance with the difference to authority?&lt;/li&gt;&#xA;&lt;li&gt;Yeah, absolutely. Without that, how can you have this &lt;strong&gt;radical&lt;/strong&gt;, dynamic entrepreneurialism you see in China? If you don&amp;rsquo;t have a sense of self, a sense of the fact that you can find opportunities, you look for opportunities, you drive opportunities, it&amp;rsquo;s all &lt;strong&gt;self-motivated&lt;/strong&gt;.&lt;/li&gt;&#xA;&lt;li&gt;Is there still a young kid in China that&amp;rsquo;s able to dream to be sort of the stereotypical Steve Jobs in the garage, start a business and change the world by doing so?&lt;/li&gt;&#xA;&lt;li&gt;There are millions of young kids like that in China. They might not be thinking about changing the world, and this is where the Chinese &lt;strong&gt;approach to innovation&lt;/strong&gt; is very different from the Silicon Valley one, I&amp;rsquo;d say. But they see opportunity. They see a country with a billion consumers. They see scale, they see speed, they see that with their dreams and the team that you have in China, with engineers, and the digital transformation, you can do so many things. And this generation of young people think about transforming their local economy. I think we&amp;rsquo;re gonna get into this, but it&amp;rsquo;s no longer gonna just be manufacturing. The young kids are entrepreneurs.&lt;/li&gt;&#xA;&lt;li&gt;Well, let&amp;rsquo;s &lt;strong&gt;stand the big picture&lt;/strong&gt;, but there&amp;rsquo;s a perception that China is a communist country. So to what degree is China a capitalist country and to what degree is it a communist country?&lt;/li&gt;&#xA;&lt;li&gt;I&amp;rsquo;ve rarely seen a more capitalist society than China from the pure economic side. I&amp;rsquo;ve rarely seen companies that are as competitive as Chinese companies. People as ambitious and obsessed with making money as Chinese people. Kind of &lt;strong&gt;ruthless&lt;/strong&gt; actually. And look, consumers shop, firms invest. If you invest well financially, you&amp;rsquo;ll get great returns. What is not capitalistic about the Chinese economy? At the same time, the social fabric is highly socialist. First of all, the state or enterprises dominate many of the &lt;strong&gt;sectors&lt;/strong&gt;. The state banks control the financial system. We often talk about common prosperity, about equal opportunity, just and fair society, but even daily stories, a walk in the park behind my my parents&amp;rsquo; apartment, you&amp;rsquo;re gonna find at least 50 organized social groups on a daily level singing, dancing, exercising, doing whatever these fantastic &lt;strong&gt;idiosyncratic&lt;/strong&gt; hobbies they have, getting together every single day. And free courses for the elderly and retired. That sense of communalism, that sense of belonging, that strive for harmony at the &lt;strong&gt;societal&lt;/strong&gt; level is there.&lt;/li&gt;&#xA;&lt;li&gt;So just to go back to something you said, there is a value for competition culturally. So on the business side, on the economic side, there is sort of a cultural value of people competing in a meritocratic way.&lt;/li&gt;&#xA;&lt;li&gt;Competition is ferocious in China, especially when it comes to Chinese companies, but also in education. I should be thankful that I&amp;rsquo;m not born later that I am, because I thought China was pretty competitive already going to the schools and studying for the exams. It is a different level today. Competition is not necessarily in the culture, I&amp;rsquo;d say. It&amp;rsquo;s driven really by the economic and social circumstances of the day. The Chinese companies are all hardworking. They&amp;rsquo;re all going after the market share. They all kind of wanna do the same thing. It&amp;rsquo;s not quite like in the US where you open a coffee shop, well, next door I&amp;rsquo;m gonna open a bagel shop, right? In China, the coffee shop &lt;strong&gt;does well&lt;/strong&gt;, everybody wants to open the same coffee shop. And I think, again, I&amp;rsquo;m sure we&amp;rsquo;re gonna get to this, but there&amp;rsquo;s a lot of that kind of competition which really drives the world sometimes crazy of replication. But it&amp;rsquo;s because it&amp;rsquo;s not easy, right? It&amp;rsquo;s not easy to make money. In education system, there are not enough jobs for the young people. So how do you get ahead? Let&amp;rsquo;s say, if you&amp;rsquo;re part of a lower stratum society, how are you gonna make sure that your children are gonna have a better life than you? You invest in education. So everything is about competition. In a country with 1.3 billion people, that&amp;rsquo;s somewhat to be expected.&lt;/li&gt;&#xA;&lt;li&gt;Let&amp;rsquo;s go back to the roots of that. So you described the China&amp;rsquo;s economy model &lt;strong&gt;is rooted in&lt;/strong&gt; its history. So can we talk about &lt;strong&gt;Confucianism&lt;/strong&gt;? Can you explain to what degree those roots run back to Confucianism, and in general, to other parts of Chinese history?&lt;/li&gt;&#xA;&lt;li&gt;Yeah, Confucianism is more of a moral philosophy than let&amp;rsquo;s say religion or a belief system. It prioritizes social harmony above anything else. It&amp;rsquo;s not about &lt;strong&gt;metaphysics&lt;/strong&gt;, but more about &lt;strong&gt;ethics&lt;/strong&gt;. And at the individual level, the responsibility, the duties are all meant to preserve that social order. So it&amp;rsquo;s filial piety, it is loyalty, it is how to be a Chinese gentleman. But things like saving, &lt;strong&gt;frugality&lt;/strong&gt;, is part of the moral discipline. Education is part of the moral cultivation. So there&amp;rsquo;s a very strong emphasis that you as a citizen have a responsibility to contribute to society as a whole.&lt;/li&gt;&#xA;&lt;li&gt;On the education side, a part of Confucianism is a value for meritocracy. So how does that permeate the education system in China? You&amp;rsquo;ve already spoken to it a little bit, the value of competition in that it&amp;rsquo;s already getting more and more intense. But it would be very interesting to get your understanding of the education system, its history, and as it stands today.&lt;/li&gt;&#xA;&lt;li&gt;If China were relatively successful economically, a huge part of the reason is by and large it&amp;rsquo;s been meritocratic. That is changing somewhat now. But the only way that you have still that many poor people, especially a couple decades back, still be in harmony with society, seeing all these rich people make tons of money and you&amp;rsquo;re still belonging to that lower stratum, the only reason is that you believe that your children have a future through meritocracy. And even though it&amp;rsquo;s imperfect, it&amp;rsquo;s highly imperfect standardized testing, all this competition, all of the hours and the tutorials to studying for standardized exams, well, that is a very realistic scenario in China, because there&amp;rsquo;s that many people. When I was growing up in school, we had 60 people per class, and there were 10 classes in one grade. Now imagine that many people applying for colleges in the American way, how many essays would have been written and need to be &lt;strong&gt;scrutinized&lt;/strong&gt;, but also that gives room for total corruption if you know what I mean, just connection-based. And actually the standardized exams, as imperfect as it is to select talent, is still by and large fair. And that&amp;rsquo;s how that whole generation of entrepreneurs, bureaucrats, government officials were selective. You look at the Chinese premiers, the presidents of the past, they all went to great schools. A lot of them were engineers. And same thing for civil servants. It has changed somewhat. The meritocracy I think is eroding in China. I&amp;rsquo;m worried about that because it is fine that you get into a good university based on your own merit, but finding a job now becomes much less meritocratic. People with connections get jobs more easily than others. Of course, this is not just a unique Chinese phenomenon, it&amp;rsquo;s actually everywhere. But I guess what I&amp;rsquo;m saying is that that meritocracy, which was so fundamental to the Chinese, ancient Chinese education system, by the way, civil servants were selected based on standardized exams in the past. That&amp;rsquo;s always been throughout Chinese history. And that relates to Confucianism. Now, the opportunities, and coming back to the competition point is that the opportunity&amp;rsquo;s getting slimmer and slimmer. And again, this is not a unique Chinese phenomenon, jobs, where are the jobs gonna be, right? So meritocracy has become more of a problem.&lt;/li&gt;&#xA;&lt;li&gt;Do you have any memories of your own experience in terms of competition, the good and the bad of it? Maybe from that, can you pull out the thread of the value of that kind of competition? Basically, I grew up in the Soviet Union, so there&amp;rsquo;s a kinda brutality to competition, but I think it ultimately molds really interesting people.&lt;/li&gt;&#xA;&lt;li&gt;There is a good and bad part of competition. I remember when I was going into middle school, every single midterm exam, final exam, you are ranked from number one to number 800 in your entire grade and publicly displayed.&lt;/li&gt;&#xA;&lt;li&gt;[Lex] Nice.&lt;/li&gt;&#xA;&lt;li&gt;Nice, right?&lt;/li&gt;&#xA;&lt;li&gt;Very nice.&lt;/li&gt;&#xA;&lt;li&gt;Imagine the majority of people and how they feel. But it does drive ambition in part. And you don&amp;rsquo;t take anything for granted. And you work hard, you keep the spirit up. But going to the US, I finally realized that Americans are totally competitive. It&amp;rsquo;s just that they don&amp;rsquo;t display it. It&amp;rsquo;s not as apparent. I remember I went to a very competitive high school, but everyone&amp;rsquo;s like so chill, oh, I&amp;rsquo;m not studying, oh&amp;hellip; They&amp;rsquo;re studying, they are secretly studying. When I was doing my PhD at Harvard, people say, &amp;ldquo;Oh, my parents say don&amp;rsquo;t work so hard.&amp;rdquo; People say, &amp;ldquo;Don&amp;rsquo;t say you worked.&amp;rdquo; They&amp;rsquo;re working hard, right? Just you don&amp;rsquo;t show it. In China, it&amp;rsquo;s kind of a noble thing to show that you&amp;rsquo;re working hard, and that you&amp;rsquo;re number one, or that you&amp;rsquo;re top of the class and you wanna display it and you want to let everybody know. But in the US, everybody&amp;rsquo;s like secretly doing it.&lt;/li&gt;&#xA;&lt;li&gt;Yeah, some of is the signaling, the culture emphasizes the signaling is it better for everything to come easily, thereby showing that you&amp;rsquo;re a genius it comes naturally, or is it better to show that you worked extremely hard for the thing, but the ultimate result is there&amp;rsquo;s still competition. But I don&amp;rsquo;t know, when you&amp;rsquo;re visually displaying and explicitly stating that it&amp;rsquo;s good to be number one and it&amp;rsquo;s bad to be number 800, I think that permeates throughout the culture to where you understand, first of all, you understand that hard work is the only way to improve, to succeed in life. And second of all, you just create this framework of early on understanding what it means to live a good life. And a part of that is to find the thing you&amp;rsquo;re damn good at and get even better at it, master it, become hopefully the best person in the world at that thing. I dunno, that&amp;rsquo;s an ex extremely important lesson for society to teach.&lt;/li&gt;&#xA;&lt;li&gt;That&amp;rsquo;s the right, I would say, the right kind of competition or the efficient kind of competition. I feel that in the Chinese education system, it was not necessarily efficient because it kind of frames you and molds you to be thinking in a certain way, what&amp;rsquo;s been taught to you. You don&amp;rsquo;t have the bandwidth, or the time, or creative freedom to be more creative and to think outside the box. There it&amp;rsquo;s just the box. You maximize the box and that&amp;rsquo;s it. You don&amp;rsquo;t actually know what&amp;rsquo;s outside of the box, and you never actually go there. That&amp;rsquo;s the bad part of Chinese competition. And when I got to the US, the high school teachers were asking us to question authority to question text. I&amp;rsquo;m like, &amp;ldquo;Wow, really? You can do that?&amp;rdquo; So I started asking why.&lt;/li&gt;&#xA;&lt;li&gt;All right, so there has been this miracle in the Chinese economy from after Mao under Deng Xiaoping where the Chinese economy got transformed and grew incredibly. So can you explain what happened? The different transformations that happened, the different reforms that happened under Deng Xiaoping.&lt;/li&gt;&#xA;&lt;li&gt;Deng Xiaoping was by far our most pragmatic leader. And I think everybody&amp;rsquo;s grateful to Deng Xiaoping. My father&amp;rsquo;s generation would not have seen that amount of prosperity and peace and opportunity without Deng Xiaoping. It started in the late 1970 s when Deng Xiaoping came out with this open up and reform &lt;strong&gt;mandate&lt;/strong&gt;, and it was very tough. Again, coming back to the big misunderstanding of China, it&amp;rsquo;s not as if one leader decides that that&amp;rsquo;s what we&amp;rsquo;re gonna do and then everybody follows order and does that. No, there are tons of political barriers, tons of incentive, compatibility problems at the local level. In the end, you need the local provincial governors, the mayors to do the job. And how many perfectas are there in China, right? A lot. And they have their own interests, right? We know this around the world, politically, it&amp;rsquo;s the most difficult thing to do. But somehow Deng Xiaoping was able to break tradition, break convention, come out with this completely new way of thinking about society, life, and economy. And it was so transformative. I remember people of that generation told me one time that society was gonna focus on the economy. Really? Why would they do that? Wasn&amp;rsquo;t it politics? Wasn&amp;rsquo;t it everything about politics, and struggle, and ideology? So for them that the whole country and the government&amp;rsquo;s gonna focus on the economy was just so shocking. Even though we take it for granted now, that shows you that breaking that mold was incredibly difficult. But I think opening up was a really momentous thing that China did. And it wasn&amp;rsquo;t just joining the deputy army, I mean, they were doing a decade of work in preparation leading up to that, what&amp;rsquo;s called special economic zone is really to turn Shenzhen from a fishing village to an export platform now to a Chinese style Silicon Valley, right? And there was the agricultural reform in the 1980 s that meant that farmers could decide what they were gonna grow and keep the surplus, whereas it was a collective system before, you know that very well. And then of course, the ultimate transformation was when China actually joined the WTO in 2001, and the rest was history, right? We&amp;rsquo;re still talking about the aftermath. But reforms was the single biggest impetus to Chinese growth. And every time there was a major reform, it was followed by a good decade long growth. Every time growth went down, there was a new series of major reforms rolled out. And then, oops, that led to another wave of good growth. But I&amp;rsquo;d say that reform pace has slowed in the last 15 years. But are there reforms to be done? Yeah, absolutely. Has China reached even close to its potential? Not at all. But again, it comes back to politics. Right now it&amp;rsquo;s less about economics, it&amp;rsquo;s more about national security, it&amp;rsquo;s more about politics. And I think that is probably the single biggest barrier to continued good economic growth,&lt;/li&gt;&#xA;&lt;li&gt;Maybe, can you speak to what it takes in such a large system in many ways, such a successful economy to do reform? So you mentioned pragmatism. Deng Xiaoping famously said that &amp;ldquo;It doesn&amp;rsquo;t matter whether the cat is black or white, as long as it catches mice.&amp;rdquo; So there&amp;rsquo;s that pragmatism that I think underlies a lot of great reforms.&lt;/li&gt;&#xA;&lt;li&gt;As a contrast to Soviet Union, the Chinese economy, as I mentioned, was extremely decentralized. In Soviet Union, the ministries were in charge of essential bureaucracy, but a lot of the power were given to these provincial governors, party secretaries, mayors of different sorts. And they were incentivized. That&amp;rsquo;s the key, is that these mayors were incentivized to do a good job. If I were successful on a radical reform, if I were successful, I&amp;rsquo;d be a national hero. And then that reform will be rolled out in every single city in the country over time. And I&amp;rsquo;ll be promoted to the higher run of the central government. And who knows, I might even become vice premier, premier president one day. That was how the individual was motivated to carry out these really tough reforms. Now, China has changed a bit, right? It&amp;rsquo;s not about being radical and radically successful. It&amp;rsquo;s about being safe, right? So when you shift from basically an entrepreneurial state to a safe state, then the objective function changes and you see it in different economic outcomes.&lt;/li&gt;&#xA;&lt;li&gt;So maybe can you speak to that. What are some important things to understand about the structure of the Chinese state?&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;Finished at 20:01&lt;/p&gt;</description>
    </item>
    <item>
      <title>volatile in sigsetjmp and siglongjmp</title>
      <link>/posts/20250829-1-volatile/</link>
      <pubDate>Fri, 29 Aug 2025 21:05:24 +0800</pubDate>
      <guid>/posts/20250829-1-volatile/</guid>
      <description>&lt;h2 id=&#34;conclusion&#34;&gt;conclusion&lt;/h2&gt;&#xA;&lt;p&gt;In postgresql, the error handling methods &lt;code&gt;pg_try() + elog() + pg_catch()&lt;/code&gt; is implemented through &lt;code&gt;sigsetjmp&lt;/code&gt; and &lt;code&gt;siglongjmp&lt;/code&gt;. But the variables changed in &lt;code&gt;pg_try()&lt;/code&gt; and used in &lt;code&gt;pg_catch()&lt;/code&gt; must be declared as &lt;code&gt;volatile&lt;/code&gt;. The reasons are below:&lt;/p&gt;&#xA;&lt;h2 id=&#34;reason&#34;&gt;reason&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;The sigsetjmp call must store all the register value and the siglongjmp restore the registers from it. It&amp;rsquo;s very reasonable in the view of asm code.&lt;/li&gt;&#xA;&lt;li&gt;If a variable is not declared as volatile, the assignment operation of it in &lt;code&gt;pg_try()&lt;/code&gt; may only changes the variable in the register. And after jumping by the &lt;code&gt;siglongjmp&lt;/code&gt; call, the value of variable is changed back to the point of &lt;code&gt;sigsetjmp&lt;/code&gt; , which means the changes in &lt;code&gt;pg_try()&lt;/code&gt; lost&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2 id=&#34;example&#34;&gt;example&lt;/h2&gt;&#xA;&lt;p&gt;Let&amp;rsquo;s consider an example:&lt;/p&gt;</description>
    </item>
    <item>
      <title>mesi-summary</title>
      <link>/post/me-z1ogd4d.html</link>
      <pubDate>Sat, 29 Mar 2025 08:56:22 +0800</pubDate>
      <guid>/post/me-z1ogd4d.html</guid>
      <description>&lt;h2 id=&#34;store-buffer&#34;&gt;store buffer&lt;/h2&gt;&#xA;&lt;h3 id=&#34;why&#34;&gt;why?&lt;/h3&gt;&#xA;&lt;p&gt;When a CPU wants to modify data (not in the &amp;ldquo;Modified&amp;rdquo; or &amp;ldquo;Exclusive&amp;rdquo; state), it will always update the data regardless of the responses from other CPUs.&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;Thus, the data is immediately updated in the store buffer.&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;h3 id=&#34;complexity-it-introduces&#34;&gt;complexity it introduces&lt;/h3&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;Multilayer caches (reason for write memory barrier):&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Example: Consider a CPU storing two values (A and B) sequentially, where A is in the store buffer and B is in the cache. It is uncertain whether another CPU will observe the updated A before observing B, as it depends on whether the invalidate message for A is received before the request for B.&lt;/li&gt;&#xA;&lt;li&gt;Reason: Broadcasting later changes (in the cache) before earlier changes (in the store buffer) are visible to others.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;strong&gt;Write memory barrier&lt;/strong&gt;: CPUs must wait until the store buffer is cleared before applying subsequent changes. Alternatively, later changes can remain in the store buffer until all prior entries in the store buffer have been processed.&lt;/p&gt;</description>
    </item>
    <item>
      <title>【日拱一卒】2025-03-02</title>
      <link>/post/20250302-8ctcr.html</link>
      <pubDate>Sun, 02 Mar 2025 20:00:48 +0800</pubDate>
      <guid>/post/20250302-8ctcr.html</guid>
      <description>&lt;h1 id=&#34;2025-03-02&#34;&gt;2025-03-02&lt;/h1&gt;&#xA;&lt;h2 id=&#34;符文般的js&#34;&gt;符文般的JS&lt;/h2&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-source&#34; data-lang=&#34;source&#34;&gt;0 = [+[]]+[]&#xA;1 = [+!+[]]+[]&#xA;10 = [+!+[]]+[+[]]&#xA;100 = [+!+[]]+[+[]]+[+[]]&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;1-0--&#34;&gt;1. &lt;code&gt;0 = [+[]]+[]&lt;/code&gt;​&lt;/h3&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;​&lt;code&gt;[]&lt;/code&gt;​ 是一个空数组。&lt;/li&gt;&#xA;&lt;li&gt;​&lt;code&gt;+[]&lt;/code&gt;​ 将空数组转换为数字。空数组转换为数字时是 &lt;code&gt;0&lt;/code&gt;​，所以 &lt;code&gt;+[]&lt;/code&gt;​ 的结果是 &lt;code&gt;0&lt;/code&gt;​。&lt;/li&gt;&#xA;&lt;li&gt;​&lt;code&gt;[+[]]&lt;/code&gt;​ 将 &lt;code&gt;0&lt;/code&gt;​ 放入一个数组中，结果是 &lt;code&gt;[0]&lt;/code&gt;​。&lt;/li&gt;&#xA;&lt;li&gt;​&lt;code&gt;[+[]]+[]&lt;/code&gt;​ 将数组 &lt;code&gt;[0]&lt;/code&gt;​ 转换为字符串，结果是 &lt;code&gt;&amp;quot;0&amp;quot;&lt;/code&gt;​。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;最终结果：&lt;code&gt;&amp;quot;0&amp;quot;&lt;/code&gt;​（字符串形式的 &lt;code&gt;0&lt;/code&gt;​）。&lt;/p&gt;</description>
    </item>
    <item>
      <title>【日拱一卒】2025-03-01</title>
      <link>/post/20250301-1r5xzc.html</link>
      <pubDate>Sat, 01 Mar 2025 15:14:45 +0800</pubDate>
      <guid>/post/20250301-1r5xzc.html</guid>
      <description>&lt;h2 id=&#34;column-oriented-storage&#34;&gt;Column-Oriented Storage&lt;/h2&gt;&#xA;&lt;h3 id=&#34;basic-idea&#34;&gt;Basic idea:&lt;/h3&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;Although fact tables are often over 100 columns wide, &lt;strong&gt;a typical data warehouse query only accesses 4 or 5 of them at one time&lt;/strong&gt; (&lt;code&gt;SELECT *&lt;/code&gt;​ queries are rarely needed for analytics)&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;The idea behind column-oriented storage is simple: &lt;strong&gt;don’t store all the values from one row together, but store all the values from each column together instead&lt;/strong&gt;. If each column is stored in a separate file, a query only needs to read and parse those columns that are used in that query, which can save a lot of work&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
